<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TaskMaster XP - تطبيق المهام المحسن</title>
  <!-- استيراد الخطوط من جوجل -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
  <!-- تضمين المكتبات -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    /* تعريف متغيرات الألوان */
    :root {
      --main-color: #00ffcc;
      --secondary-color: #302b63;
      --dark-bg: #0f0c29;
      --light-bg: #ffffff;
      --text-dark: #fff;
      --text-light: #000;
      --success-color: #00ffaa;
      --warning-color: #ffaa00;
      --danger-color: #ff5555;
      --priority-high: #ff5555;
      --priority-medium: #ffaa00;
      --priority-low: #55ff00;
    }
    
    /* الأساسيات */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Tajawal', sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, var(--dark-bg), var(--secondary-color), #24243e);
      color: var(--text-dark);
      overflow-x: hidden;
      min-height: 100vh;
      transition: all 0.3s ease;
    }
    
    body.light-mode {
      background: linear-gradient(135deg, var(--light-bg), #e0e0e0);
      color: var(--text-light);
    }
    
    /* الهيدر */
    header {
      padding: 2rem;
      text-align: center;
      background: rgba(0, 0, 0, 0.4);
      box-shadow: 0 0 15px var(--main-color);
    }

.tabs {
  position: relative;
  display: flex;
  justify-content: space-around;
  border-bottom: 2px solid #ddd;
}

.tab {
  position: relative;
  padding: 10px 20px;
  cursor: pointer;
  font-weight: bold;
  color: #333;
  transition: color 0.3s ease;
}

.tab:hover {
  color: #007bff; /* لون عند المرور */
}

.tab.active {
  color: #007bff;
}

.tabs::after {
  content: '';
  position: absolute;
  bottom: 0;
  height: 3px;
  background-color: #007bff;
  transition: all 0.3s ease;
  width: 0;
}

.tab.active ~ .tabs::after {
  width: 100%;
}


    
    
    h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 3rem;
      color: var(--main-color);
      text-shadow: 0 0 10px var(--main-color);
    }
    
    p.subtitle {
      font-size: 1.2rem;
      margin-top: 0.5rem;
      color: #ccc;
      text-shadow: 0 0 5px #00ffaa;
    }
    
    /* الحاويات */
    .container {
      max-width: 1200px;
      margin: 3rem auto;
      padding: 2rem;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      box-shadow: 0 0 30px rgba(0, 255, 170, 0.3);
    }
    
    /* الأقسام */
    .section {
      margin-bottom: 2rem;
      padding: 1.5rem;
      background-color: rgba(0, 0, 0, 0.2);
      border-radius: 15px;
      box-shadow: inset 0 0 10px rgba(0, 255, 170, 0.3);
    }
    
    .section-title {
      color: var(--main-color);
      margin-bottom: 1rem;
      font-size: 1.5rem;
      border-bottom: 2px solid var(--main-color);
      padding-bottom: 0.5rem;
    }
    
    /* شريط التقدم */
    .progress-container {
      margin: 1.5rem 0;
    }
    
    .progress-bar {
      height: 25px;
      background: #222;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: inset 0 0 10px #00ff99;
    }
    
    .progress-fill {
      height: 100%;
      width: 0;
      background: linear-gradient(to right, #00ffaa, #00ccff);
      transition: width 0.4s ease;
    }
    
    /* المهام */
    .tasks-container {
      margin-top: 2rem;
    }
    
    .tasks-list {
      list-style: none;
      padding: 0;
    }
    
    .task-item {
      background: rgba(255, 255, 255, 0.1);
      padding: 1.2rem;
      margin-bottom: 1rem;
      border-radius: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
      border-left: 5px solid var(--main-color);
      position: relative;
      animation: slideDown 0.5s ease;
    }
    
    .task-item.completed {
      border-left-color: var(--success-color);
      opacity: 0.7;
    }
    
    .task-item.overdue {
      border-left-color: var(--danger-color);
      animation: pulseWarning 1.5s infinite;
    }
    
    .task-item.due-soon {
      border-left-color: var(--warning-color);
    }
    
    .task-content {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .task-title {
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
    }
    
    .task-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      font-size: 0.9rem;
      color: #aaa;
    }
    
    .task-priority {
      padding: 0.2rem 0.5rem;
      border-radius: 5px;
      font-weight: bold;
    }
    
    .priority-high {
      background-color: rgba(255, 85, 85, 0.2);
      color: var(--priority-high);
    }
    
    .priority-medium {
      background-color: rgba(255, 170, 0, 0.2);
      color: var(--priority-medium);
    }
    
    .priority-low {
      background-color: rgba(85, 255, 0, 0.2);
      color: var(--priority-low);
    }
    
    .task-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .task-btn {
      background-color: transparent;
      border: 2px solid var(--main-color);
      color: var(--main-color);
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: bold;
    }
    
    .task-btn:hover {
      background-color: var(--main-color);
      color: #000;
    }
    
    .task-btn.complete {
      border-color: var(--success-color);
      color: var(--success-color);
    }
    
    .task-btn.complete:hover {
      background-color: var(--success-color);
      color: #000;
    }
    
    .task-btn.edit {
      border-color: var(--warning-color);
      color: var(--warning-color);
    }
    
    .task-btn.edit:hover {
      background-color: var(--warning-color);
      color: #000;
    }
    
    .task-btn.delete {
      border-color: var(--danger-color);
      color: var(--danger-color);
    }
    
    .task-btn.delete:hover {
      background-color: var(--danger-color);
      color: #fff;
    }
    
    /* نموذج إضافة مهمة */
    .task-form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
    }
    
    .form-label {
      margin-bottom: 0.5rem;
      color: var(--main-color);
      font-weight: bold;
    }
    
    .form-control {
      padding: 0.8rem;
      border-radius: 8px;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      font-size: 1rem;
      outline: none;
      transition: all 0.3s ease;
    }
    
    .form-control:focus {
      box-shadow: 0 0 0 2px var(--main-color);
    }
    
    .btn {
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 8px;
      background-color: var(--main-color);
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 255, 170, 0.4);
    }
    
    .btn-secondary {
      background-color: rgba(255, 255, 255, 0.1);
      color: #fff;
    }
    
    /* لوحة التحكم */
    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }
    
    .widget {
      background: rgba(0, 0, 0, 0.2);
      padding: 1.5rem;
      border-radius: 15px;
      box-shadow: inset 0 0 10px rgba(0, 255, 170, 0.2);
    }
    
    .widget-title {
      color: var(--main-color);
      margin-bottom: 1rem;
      font-size: 1.2rem;
    }
    
    /* التنقل */
    .tabs {
      display: flex;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 1.5rem;
    }
    
    .tab {
      padding: 0.8rem 1.5rem;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
    }
    
    .tab.active {
      border-bottom-color: var(--main-color);
      color: var(--main-color);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* الرسوم البيانية */
    .chart-container {
      position: relative;
      height: 250px;
      width: 100%;
    }
    
    /* الإنجازات */
    .badges-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 1rem;
    }
    
    .badge {
      background: rgba(0, 255, 170, 0.1);
      border-radius: 10px;
      padding: 1rem;
      text-align: center;
      transition: all 0.3s ease;
    }
    
    .badge:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0, 255, 170, 0.3);
    }
    
    .badge-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      color: var(--main-color);
    }
    
    .badge-title {
      font-weight: bold;
      margin-bottom: 0.3rem;
    }
    
    .badge-desc {
      font-size: 0.8rem;
      color: #aaa;
    }
    
    .badge.locked {
      opacity: 0.5;
      filter: grayscale(100%);
    }
    
    /* الوضع المظلم */
    body.light-mode .task-item {
      background: rgba(0, 0, 0, 0.05);
    }
    
    body.light-mode .form-control {
      background: rgba(0, 0, 0, 0.05);
      color: #000;
    }
    
    body.light-mode .widget {
      background: rgba(0, 0, 0, 0.05);
    }
    
    /* الرسوم المتحركة */
    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulseWarning {
      0% { box-shadow: 0 0 0 0 rgba(255, 85, 85, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(255, 85, 85, 0); }
      100% { box-shadow: 0 0 0 0 rgba(255, 85, 85, 0); }
    }
    
    /* التكيف مع الشاشات الصغيرة */
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
        margin: 1rem auto;
      }
      
      .task-form {
        grid-template-columns: 1fr;
      }
      
      .task-item {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .task-actions {
        margin-top: 1rem;
        width: 100%;
        justify-content: flex-end;
      }
    }
    
    /* أسلوب RTL */
    [dir="rtl"] .task-item {
      border-left: none;
      border-right: 5px solid var(--main-color);
    }
    
    [dir="rtl"] .task-item.completed {
      border-left: none;
      border-right: 5px solid var(--success-color);
    }
    
    [dir="rtl"] .tabs {
      padding-right: 0;
    }
  </style>
</head>
<body>
  <!-- الهيدر -->
  <header>
    <h1>TaskMaster XP</h1>
    <p class="subtitle">حول إنتاجيتك إلى لعبة</p>
  </header>

  <div class="container">
    <!-- التنقل -->
    <div class="tabs">
      <div class="tab active" onclick="switchTab('tasks')">المهام</div>
      <div class="tab" onclick="switchTab('dashboard')">لوحة التحكم</div>
      <div class="tab" onclick="switchTab('stats')">الإحصائيات</div>
      <div class="tab" onclick="switchTab('achievements')">الإنجازات</div>
      <div class="tab" onclick="switchTab('team')">الفريق</div>
    </div>

    <!-- قسم المهام -->
    <div id="tasks-tab" class="tab-content active">
      <!-- شريط التقدم -->
      <div class="section">
        <h3 class="section-title">تقدمك</h3>
        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress-fill" id="xpBar"></div>
          </div>
          <div class="level-display">
            المستوى: <span id="level">1</span> | النقاط: <span id="xp">0</span>/<span id="xpMax">100</span>
          </div>
        </div>
      </div>

      <!-- نموذج إضافة مهمة -->
      <div class="section">
        <h3 class="section-title">إضافة مهمة جديدة</h3>
        <div class="task-form">
          <div class="form-group">
            <label for="taskTitle" class="form-label">عنوان المهمة</label>
            <input type="text" id="taskTitle" class="form-control" placeholder="أدخل عنوان المهمة">
          </div>
          
          <div class="form-group">
            <label for="taskDescription" class="form-label">الوصف (اختياري)</label>
            <textarea id="taskDescription" class="form-control" rows="1" placeholder="أضف وصفًا للمهمة"></textarea>
          </div>
          
          <div class="form-group">
            <label for="taskDeadline" class="form-label">الموعد النهائي</label>
            <input type="datetime-local" id="taskDeadline" class="form-control">
          </div>
          
          <div class="form-group">
            <label for="taskPriority" class="form-label">الأولوية</label>
            <select id="taskPriority" class="form-control">
              <option value="low">منخفضة</option>
              <option value="medium" selected>متوسطة</option>
              <option value="high">عالية</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="taskCategory" class="form-label">الفئة</label>
            <select id="taskCategory" class="form-control">
              <option value="work">عمل</option>
              <option value="personal">شخصي</option>
              <option value="study">دراسة</option>
              <option value="health">صحة</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="taskRepeat" class="form-label">التكرار</label>
            <select id="taskRepeat" class="form-control">
              <option value="none">لا يوجد</option>
              <option value="daily">يومي</option>
              <option value="weekly">أسبوعي</option>
              <option value="monthly">شهري</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="taskFile" class="form-label">مرفق (اختياري)</label>
            <input type="file" id="taskFile" class="form-control">
          </div>
          
          <div class="form-group">
            <label for="taskReminder" class="form-label">تذكير قبل</label>
            <select id="taskReminder" class="form-control">
              <option value="none">لا يوجد</option>
              <option value="15m">15 دقيقة</option>
              <option value="1h">ساعة واحدة</option>
              <option value="1d">يوم واحد</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">الإجراءات</label>
            <div style="display: flex; gap: 0.5rem;">
              <button class="btn" onclick="addTask()">
                <i class="icon">+</i> إضافة مهمة
              </button>
              <button class="btn btn-secondary" onclick="startVoiceInput()">
                <i class="icon">🎤</i> إدخال صوتي
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- فلترة وترتيب المهام -->
      <div class="section">
        <h3 class="section-title">إدارة المهام</h3>
        <div style="display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem;">
          <div class="form-group" style="flex: 1; min-width: 150px;">
            <label for="filterTasks" class="form-label">تصفية المهام</label>
            <select id="filterTasks" class="form-control" onchange="filterTasks(this.value)">
              <option value="all">الكل</option>
              <option value="completed">مكتملة</option>
              <option value="pending">قيد الإنجاز</option>
              <option value="overdue">متأخرة</option>
            </select>
          </div>
          
          <div class="form-group" style="flex: 1; min-width: 150px;">
            <label for="sortTasks" class="form-label">ترتيب المهام</label>
            <select id="sortTasks" class="form-control" onchange="sortTasks(this.value)">
              <option value="date-desc">الأحدث أولاً</option>
              <option value="date-asc">الأقدم أولاً</option>
              <option value="priority">حسب الأولوية</option>
            </select>
          </div>
          
          <div class="form-group" style="flex: 1; min-width: 150px;">
            <label for="searchTasks" class="form-label">بحث</label>
            <input type="text" id="searchTasks" class="form-control" placeholder="ابحث في المهام..." oninput="searchTasks(this.value)">
          </div>
        </div>
      </div>

      <!-- قائمة المهام -->
      <div class="section tasks-container">
        <h3 class="section-title">قائمة المهام</h3>
        <ul class="tasks-list" id="taskList">
          <!-- المهام ستضاف هنا ديناميكيًا -->
        </ul>
      </div>
    </div>

    <!-- لوحة التحكم -->
    <div id="dashboard-tab" class="tab-content">
      <div class="dashboard">
        <!-- إحصائيات سريعة -->
        <div class="widget">
          <h4 class="widget-title">إحصائيات سريعة</h4>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div style="background: rgba(0, 255, 170, 0.1); padding: 1rem; border-radius: 10px;">
              <div style="font-size: 2rem; color: var(--main-color);">12</div>
              <div style="font-size: 0.8rem;">المهام المكتملة</div>
            </div>
            <div style="background: rgba(0, 255, 170, 0.1); padding: 1rem; border-radius: 10px;">
              <div style="font-size: 2rem; color: var(--main-color);">5</div>
              <div style="font-size: 0.8rem;">المهام النشطة</div>
            </div>
            <div style="background: rgba(0, 255, 170, 0.1); padding: 1rem; border-radius: 10px;">
              <div style="font-size: 2rem; color: var(--main-color);">3</div>
              <div style="font-size: 0.8rem;">المهام المتأخرة</div>
            </div>
            <div style="background: rgba(0, 255, 170, 0.1); padding: 1rem; border-radius: 10px;">
              <div style="font-size: 2rem; color: var(--main-color);">85%</div>
              <div style="font-size: 0.8rem;">معدل الإنجاز</div>
            </div>
          </div>
        </div>
        
        <!-- تقدم الأسبوع -->
        <div class="widget">
          <h4 class="widget-title">تقدم الأسبوع</h4>
          <div class="chart-container">
            <canvas id="weeklyChart"></canvas>
          </div>
        </div>
        
        <!-- توزيع المهام -->
        <div class="widget">
          <h4 class="widget-title">توزيع المهام</h4>
          <div class="chart-container">
            <canvas id="tasksChart"></canvas>
          </div>
        </div>
        
        <!-- نشاط الفريق -->
        <div class="widget">
          <h4 class="widget-title">نشاط الفريق</h4>
          <div style="margin-top: 1rem;">
            <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
              <div style="width: 30px; height: 30px; background: #00ffaa; border-radius: 50%; margin-left: 0.5rem;"></div>
              <div style="flex: 1;">
                <div>أحمد</div>
                <div style="height: 5px; background: rgba(255,255,255,0.1); margin-top: 0.2rem;">
                  <div style="width: 75%; height: 100%; background: var(--main-color);"></div>
                </div>
              </div>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
              <div style="width: 30px; height: 30px; background: #00aaff; border-radius: 50%; margin-left: 0.5rem;"></div>
              <div style="flex: 1;">
                <div>محمد</div>
                <div style="height: 5px; background: rgba(255,255,255,0.1); margin-top: 0.2rem;">
                  <div style="width: 60%; height: 100%; background: var(--main-color);"></div>
                </div>
              </div>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
              <div style="width: 30px; height: 30px; background: #aa00ff; border-radius: 50%; margin-left: 0.5rem;"></div>
              <div style="flex: 1;">
                <div>سارة</div>
                <div style="height: 5px; background: rgba(255,255,255,0.1); margin-top: 0.2rem;">
                  <div style="width: 90%; height: 100%; background: var(--main-color);"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- المهام القادمة -->
        <div class="widget">
          <h4 class="widget-title">المهام القادمة</h4>
          <div style="margin-top: 1rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
              <div>اجتماع الفريق</div>
              <div style="color: #aaa; font-size: 0.8rem;">غدًا 10 ص</div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
              <div>تسليم المشروع</div>
              <div style="color: #aaa; font-size: 0.8rem;">بعد غد 3 م</div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
              <div>مراجعة الوثائق</div>
              <div style="color: #aaa; font-size: 0.8rem;">الجمعة 11 ص</div>
            </div>
          </div>
        </div>
        
        <!-- الإنجازات الأخيرة -->
        <div class="widget">
          <h4 class="widget-title">الإنجازات الأخيرة</h4>
          <div style="margin-top: 1rem;">
            <div style="display: flex; align-items: center; margin-bottom: 0.5rem; padding: 0.5rem; background: rgba(0,255,170,0.1); border-radius: 8px;">
              <div style="width: 30px; height: 30px; background: gold; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-left: 0.5rem;">🏆</div>
              <div>
                <div style="font-weight: bold;">بطل الإنتاجية</div>
                <div style="font-size: 0.8rem; color: #aaa;">أكملت 10 مهام هذا الأسبوع</div>
              </div>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 0.5rem; padding: 0.5rem; background: rgba(0,255,170,0.1); border-radius: 8px;">
              <div style="width: 30px; height: 30px; background: silver; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-left: 0.5rem;">⭐</div>
              <div>
                <div style="font-weight: bold;">مثابر</div>
                <div style="font-size: 0.8rem; color: #aaa;">عملت 5 أيام متتالية</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- قسم الإحصائيات -->
    <div id="stats-tab" class="tab-content">
      <div class="dashboard">
        <!-- إحصائيات المهام -->
        <div class="widget">
          <h4 class="widget-title">إحصائيات المهام</h4>
          <div class="chart-container">
            <canvas id="statsChart"></canvas>
          </div>
        </div>
        
        <!-- أداء الأسبوع -->
        <div class="widget">
          <h4 class="widget-title">أداء الأسبوع</h4>
          <div class="chart-container">
            <canvas id="performanceChart"></canvas>
          </div>
        </div>
        
        <!-- توزيع الأولويات -->
        <div class="widget">
          <h4 class="widget-title">توزيع الأولويات</h4>
          <div class="chart-container">
            <canvas id="priorityChart"></canvas>
          </div>
        </div>
        
        <!-- سجل النشاط -->
        <div class="widget">
          <h4 class="widget-title">سجل النشاط</h4>
          <div style="max-height: 300px; overflow-y: auto; margin-top: 1rem;">
            <div style="display: flex; margin-bottom: 0.5rem; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
              <div style="width: 30px; height: 30px; background: rgba(0,255,170,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-left: 0.5rem;">✓</div>
              <div>
                <div>أكملت مهمة "مراجعة التصميم"</div>
                <div style="font-size: 0.8rem; color: #aaa;">اليوم 10:45 ص</div>
              </div>
            </div>
            <div style="display: flex; margin-bottom: 0.5rem; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
              <div style="width: 30px; height: 30px; background: rgba(255,85,85,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-left: 0.5rem;">✗</div>
              <div>
                <div>حذفت مهمة "اجتماع غير مهم"</div>
                <div style="font-size: 0.8rem; color: #aaa;">اليوم 9:30 ص</div>
              </div>
            </div>
            <div style="display: flex; margin-bottom: 0.5rem; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
              <div style="width: 30px; height: 30px; background: rgba(0,170,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-left: 0.5rem;">+</div>
              <div>
                <div>أضفت مهمة جديدة "تسليم المشروع"</div>
                <div style="font-size: 0.8rem; color: #aaa;">بالأمس 4:15 م</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- قسم الإنجازات -->
    <div id="achievements-tab" class="tab-content">
      <div class="section">
        <h3 class="section-title">إنجازاتك</h3>
        <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
          <div style="flex: 1; background: rgba(0,255,170,0.1); padding: 1rem; border-radius: 10px; text-align: center;">
            <div style="font-size: 2rem;">3</div>
            <div style="font-size: 0.9rem;">إنجازات مكتملة</div>
          </div>
          <div style="flex: 1; background: rgba(0,255,170,0.1); padding: 1rem; border-radius: 10px; text-align: center;">
            <div style="font-size: 2rem;">7</div>
            <div style="font-size: 0.9rem;">إنجازات متبقية</div>
          </div>
          <div style="flex: 1; background: rgba(0,255,170,0.1); padding: 1rem; border-radius: 10px; text-align: center;">
            <div style="font-size: 2rem;">85%</div>
            <div style="font-size: 0.9rem;">تقدم عام</div>
          </div>
        </div>
        
        <h4 style="margin: 1.5rem 0 1rem 0; color: var(--main-color);">الإنجازات المكتملة</h4>
        <div class="badges-container">
          <div class="badge">
            <div class="badge-icon">🏆</div>
            <div class="badge-title">البداية</div>
            <div class="badge-desc">أضف أول مهمة</div>
          </div>
          <div class="badge">
            <div class="badge-icon">⭐</div>
            <div class="badge-title">المثابر</div>
            <div class="badge-desc">أكمل 5 مهام</div>
          </div>
          <div class="badge">
            <div class="badge-icon">🚀</div>
            <div class="badge-title">المستوى الأول</div>
            <div class="badge-desc">صل إلى المستوى 5</div>
          </div>
        </div>
        
        <h4 style="margin: 1.5rem 0 1rem 0; color: var(--main-color);">الإنجازات القادمة</h4>
        <div class="badges-container">
          <div class="badge locked">
            <div class="badge-icon">🔒</div>
            <div class="badge-title">بطل السرعة</div>
            <div class="badge-desc">أكمل 3 مهام في يوم واحد</div>
          </div>
          <div class="badge locked">
            <div class="badge-icon">🔒</div>
            <div class="badge-title">المنظم</div>
            <div class="badge-desc">أنشئ 5 فئات للمهام</div>
          </div>
          <div class="badge locked">
            <div class="badge-icon">🔒</div>
            <div class="badge-title">الفريق</div>
            <div class="badge-desc">شارك 3 مهام مع فريق</div>
          </div>
        </div>
      </div>
    </div>

    <!-- قسم الفريق -->
    <div id="team-tab" class="tab-content">
      <div class="section">
        <h3 class="section-title">فريقك</h3>
        <div style="margin-bottom: 1.5rem;">
          <button class="btn" onclick="showInviteModal()">
            <i class="icon">👥</i> دعوة أعضاء جدد
          </button>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem;">
          <!-- عضو الفريق -->
          <div style="background: rgba(0,0,0,0.2); padding: 1.5rem; border-radius: 15px;">
            <div style="display: flex; align-items: center; margin-bottom: 1rem;">
              <div style="width: 50px; height: 50px; background: #00ffaa; border-radius: 50%; margin-left: 1rem;"></div>
              <div>
                <div style="font-weight: bold;">أحمد محمد</div>
                <div style="font-size: 0.8rem; color: #aaa;">مدير المشروع</div>
              </div>
            </div>
            <div style="margin-bottom: 0.5rem;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                <span>المهام المكتملة:</span>
                <span style="font-weight: bold;">24</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                <span>المهام النشطة:</span>
                <span style="font-weight: bold;">5</span>
              </div>
              <div style="display: flex; justify-content: space-between;">
                <span>معدل الإنجاز:</span>
                <span style="font-weight: bold;">92%</span>
              </div>
            </div>
            <button class="btn btn-secondary" style="width: 100%; margin-top: 0.5rem;">إرسال رسالة</button>
          </div>
          
          <!-- عضو الفريق -->
          <div style="background: rgba(0,0,0,0.2); padding: 1.5rem; border-radius: 15px;">
            <div style="display: flex; align-items: center; margin-bottom: 1rem;">
              <div style="width: 50px; height: 50px; background: #00aaff; border-radius: 50%; margin-left: 1rem;"></div>
              <div>
                <div style="font-weight: bold;">سارة علي</div>
                <div style="font-size: 0.8rem; color: #aaa;">مصممة UI/UX</div>
              </div>
            </div>
            <div style="margin-bottom: 0.5rem;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                <span>المهام المكتملة:</span>
                <span style="font-weight: bold;">18</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                <span>المهام النشطة:</span>
                <span style="font-weight: bold;">3</span>
              </div>
              <div style="display: flex; justify-content: space-between;">
                <span>معدل الإنجاز:</span>
                <span style="font-weight: bold;">88%</span>
              </div>
            </div>
            <button class="btn btn-secondary" style="width: 100%; margin-top: 0.5rem;">إرسال رسالة</button>
          </div>
          
          <!-- عضو الفريق -->
          <div style="background: rgba(0,0,0,0.2); padding: 1.5rem; border-radius: 15px;">
            <div style="display: flex; align-items: center; margin-bottom: 1rem;">
              <div style="width: 50px; height: 50px; background: #aa00ff; border-radius: 50%; margin-left: 1rem;"></div>
              <div>
                <div style="font-weight: bold;">محمد خالد</div>
                <div style="font-size: 0.8rem; color: #aaa;">مطور الواجهة الأمامية</div>
              </div>
            </div>
            <div style="margin-bottom: 0.5rem;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                <span>المهام المكتملة:</span>
                <span style="font-weight: bold;">15</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                <span>المهام النشطة:</span>
                <span style="font-weight: bold;">4</span>
              </div>
              <div style="display: flex; justify-content: space-between;">
                <span>معدل الإنجاز:</span>
                <span style="font-weight: bold;">85%</span>
              </div>
            </div>
            <button class="btn btn-secondary" style="width: 100%; margin-top: 0.5rem;">إرسال رسالة</button>
          </div>
        </div>
        
        <!-- المهام المشتركة -->
        <h3 class="section-title" style="margin-top: 2rem;">المهام المشتركة</h3>
        <ul class="tasks-list" id="sharedTasksList">
          <!-- المهام المشتركة ستضاف هنا ديناميكيًا -->
        </ul>
      </div>
    </div>

    <!-- الإعدادات -->
    <div class="section">
      <h3 class="section-title">الإعدادات</h3>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
        <!-- المظهر -->
        <div>
          <h4 style="margin-bottom: 1rem; color: var(--main-color);">المظهر</h4>
          <div style="margin-bottom: 0.5rem;">
            <input type="checkbox" id="darkMode" onchange="toggleTheme()">
            <label for="darkMode">الوضع المظلم</label>
          </div>
          <div style="margin-bottom: 0.5rem;">
            <label for="themeColor" style="display: block; margin-bottom: 0.5rem;">لون السمة:</label>
            <select id="themeColor" class="form-control" onchange="changeThemeColor(this.value)">
              <option value="#00ffcc">أزرق مخضر</option>
              <option value="#ff0055">أحمر</option>
              <option value="#55ff00">أخضر</option>
              <option value="#ffaa00">برتقالي</option>
              <option value="#aa00ff">بنفسجي</option>
            </select>
          </div>
        </div>
        
        <!-- الإشعارات -->
        <div>
          <h4 style="margin-bottom: 1rem; color: var(--main-color);">الإشعارات</h4>
          <div style="margin-bottom: 0.5rem;">
            <input type="checkbox" id="enableNotifications" checked>
            <label for="enableNotifications">تفعيل الإشعارات</label>
          </div>
          <div style="margin-bottom: 0.5rem;">
            <input type="checkbox" id="enableSounds" checked>
            <label for="enableSounds">أصوات التطبيق</label>
          </div>
          <div style="margin-bottom: 0.5rem;">
            <input type="checkbox" id="enableEmailReminders">
            <label for="enableEmailReminders">تذكيرات البريد الإلكتروني</label>
          </div>
        </div>
        
        <!-- الحساب -->
        <div>
          <h4 style="margin-bottom: 1rem; color: var(--main-color);">الحساب</h4>
          <button class="btn btn-secondary" style="width: 100%; margin-bottom: 0.5rem;">تغيير كلمة المرور</button>
          <button class="btn btn-secondary" style="width: 100%; margin-bottom: 0.5rem;">ربط بحساب Google</button>
          <button class="btn btn-secondary" style="width: 100%;" onclick="exportData()">تصدير البيانات</button>
        </div>
      </div>
    </div>
  </div>

  <!-- الفوتر -->
  <footer style="text-align: center; padding: 1.5rem; color: #aaa; font-size: 0.9rem;">
    <p>TaskMaster XP &copy; 2023 - جميع الحقوق محفوظة</p>
    <p style="margin-top: 0.5rem;">الإصدار 2.1.0</p>
  </footer>

  <!-- نافذة الدعوة -->
  <div id="inviteModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background: #1a1a2e; padding: 2rem; border-radius: 15px; max-width: 500px; width: 90%;">
      <h3 style="margin-bottom: 1.5rem; color: var(--main-color);">دعوة أعضاء جدد</h3>
      <div class="form-group" style="margin-bottom: 1rem;">
        <label class="form-label">البريد الإلكتروني</label>
        <input type="email" id="inviteEmail" class="form-control" placeholder="أدخل البريد الإلكتروني">
      </div>
      <div class="form-group" style="margin-bottom: 1.5rem;">
        <label class="form-label">الدور</label>
        <select id="inviteRole" class="form-control">
          <option value="member">عضو</option>
          <option value="admin">مدير</option>
        </select>
      </div>
      <div style="display: flex; gap: 0.5rem;">
        <button class="btn" onclick="sendInvite()">إرسال الدعوة</button>
        <button class="btn btn-secondary" onclick="hideInviteModal()">إلغاء</button>
      </div>
    </div>
  </div>

  <!-- الكود البرمجي -->
  <script>
    // حالة التطبيق
    const state = {
      tasks: [],
      user: {
        level: 1,
        xp: 0,
        xpToNextLevel: 100,
        achievements: []
      },
      team: [],
      settings: {
        darkMode: false,
        themeColor: '#00ffcc',
        notifications: true,
        sounds: true
      }
    };

    // تهيئة التطبيق
    document.addEventListener('DOMContentLoaded', function() {
      loadState();
      renderTasks();
      initCharts();
      updateXPBar();
      
      // تحميل المهام من localStorage
      const savedTasks = localStorage.getItem('tasks');
      if (savedTasks) {
        state.tasks = JSON.parse(savedTasks);
        renderTasks();
      }
      
      // تحميل الإعدادات
      const savedSettings = localStorage.getItem('settings');
      if (savedSettings) {
        state.settings = JSON.parse(savedSettings);
        applySettings();
      }
      
      // التحقق من المواعيد النهائية كل دقيقة
      setInterval(checkDeadlines, 60000);
    });

    // وظائف التطبيق الأساسية
    function addTask() {
      const title = document.getElementById('taskTitle').value.trim();
      const description = document.getElementById('taskDescription').value.trim();
      const deadline = document.getElementById('taskDeadline').value;
      const priority = document.getElementById('taskPriority').value;
      const category = document.getElementById('taskCategory').value;
      const repeat = document.getElementById('taskRepeat').value;
      const reminder = document.getElementById('taskReminder').value;
      const file = document.getElementById('taskFile').files[0];
      
      if (!title) {
        alert('الرجاء إدخال عنوان للمهمة');
        return;
      }
      
      const newTask = {
        id: Date.now(),
        title,
        description,
        deadline,
        priority,
        category,
        repeat,
        reminder,
        completed: false,
        createdAt: new Date().toISOString(),
        file: file ? file.name : null
      };
      
      state.tasks.push(newTask);
      saveTasks();
      renderTasks();
      
      // إعادة تعيين النموذج
      document.getElementById('taskTitle').value = '';
      document.getElementById('taskDescription').value = '';
      document.getElementById('taskFile').value = '';
      
      // مكافأة XP
      gainXP(10);
    }

    function completeTask(taskId) {
      const task = state.tasks.find(t => t.id === taskId);
      if (task) {
        task.completed = true;
        task.completedAt = new Date().toISOString();
        saveTasks();
        renderTasks();
        
        // مكافأة XP
        gainXP(20);
        
        // التحقق من الإنجازات
        checkAchievements();
      }
    }

    function deleteTask(taskId) {
      state.tasks = state.tasks.filter(t => t.id !== taskId);
      saveTasks();
      renderTasks();
    }

    function editTask(taskId) {
      const task = state.tasks.find(t => t.id === taskId);
      if (!task) return;
      
      document.getElementById('taskTitle').value = task.title;
      document.getElementById('taskDescription').value = task.description || '';
      document.getElementById('taskDeadline').value = task.deadline || '';
      document.getElementById('taskPriority').value = task.priority;
      document.getElementById('taskCategory').value = task.category;
      document.getElementById('taskRepeat').value = task.repeat;
      document.getElementById('taskReminder').value = task.reminder;
      
      // حذف المهمة القديمة
      deleteTask(taskId);
      
      // تمرير التركيز إلى حقل العنوان
      document.getElementById('taskTitle').focus();
    }

    // وظائف التقدم والمستويات
    function gainXP(amount) {
      state.user.xp += amount;
      
      // التحقق من الترقية
      if (state.user.xp >= state.user.xpToNextLevel) {
        state.user.xp -= state.user.xpToNextLevel;
        state.user.level++;
        state.user.xpToNextLevel = Math.floor(state.user.xpToNextLevel * 1.2);
        
        alert(`تهانينا! لقد وصلت إلى المستوى ${state.user.level}!`);
        
        // التحقق من الإنجازات
        checkAchievements();
      }
      
      updateXPBar();
      saveState();
    }

    function updateXPBar() {
      const percent = (state.user.xp / state.user.xpToNextLevel) * 100;
      document.getElementById('xpBar').style.width = `${percent}%`;
      document.getElementById('level').textContent = state.user.level;
      document.getElementById('xp').textContent = state.user.xp;
      document.getElementById('xpMax').textContent = state.user.xpToNextLevel;
    }

    // وظائف الإنجازات
    function checkAchievements() {
      const achievements = [
        { id: 'first_task', condition: state.tasks.length >= 1, title: 'البداية', description: 'أضف أول مهمة' },
        { id: 'five_tasks', condition: state.tasks.filter(t => t.completed).length >= 5, title: 'المثابر', description: 'أكمل 5 مهام' },
        { id: 'level_five', condition: state.user.level >= 5, title: 'المستوى الأول', description: 'صل إلى المستوى 5' },
        { id: 'ten_tasks_day', condition: checkTasksCompletedToday() >= 3, title: 'بطل السرعة', description: 'أكمل 3 مهام في يوم واحد' }
      ];
      
      achievements.forEach(ach => {
        if (ach.condition && !state.user.achievements.includes(ach.id)) {
          state.user.achievements.push(ach.id);
          showAchievementUnlocked(ach.title, ach.description);
        }
      });
      
      saveState();
    }

    function checkTasksCompletedToday() {
      const today = new Date().toISOString().split('T')[0];
      return state.tasks.filter(t => t.completedAt && t.completedAt.includes(today)).length;
    }

    function showAchievementUnlocked(title, description) {
      const achievementDiv = document.createElement('div');
      achievementDiv.style.position = 'fixed';
      achievementDiv.style.bottom = '20px';
      achievementDiv.style.left = '20px';
      achievementDiv.style.background = 'rgba(0,0,0,0.8)';
      achievementDiv.style.color = 'gold';
      achievementDiv.style.padding = '15px';
      achievementDiv.style.borderRadius = '10px';
      achievementDiv.style.borderLeft = '5px solid gold';
      achievementDiv.style.zIndex = '1000';
      achievementDiv.style.maxWidth = '300px';
      achievementDiv.style.animation = 'slideIn 0.5s ease';
      
      achievementDiv.innerHTML = `
        <div style="font-weight: bold; font-size: 1.2rem; margin-bottom: 5px;">🏆 ${title}</div>
        <div style="font-size: 0.9rem;">${description}</div>
      `;
      
      document.body.appendChild(achievementDiv);
      
      setTimeout(() => {
        achievementDiv.style.animation = 'slideOut 0.5s ease';
        setTimeout(() => {
          document.body.removeChild(achievementDiv);
        }, 500);
      }, 3000);
    }

    // وظائف العرض
    function renderTasks() {
      const taskList = document.getElementById('taskList');
      taskList.innerHTML = '';
      
      state.tasks.forEach(task => {
        const taskElement = document.createElement('li');
        taskElement.className = 'task-item';
        taskElement.dataset.id = task.id;
        
        if (task.completed) {
          taskElement.classList.add('completed');
        }
        
        // التحقق من المواعيد النهائية
        if (task.deadline) {
          const deadlineDate = new Date(task.deadline);
          const now = new Date();
          
          if (deadlineDate < now) {
            taskElement.classList.add('overdue');
          } else if ((deadlineDate - now) < 24 * 60 * 60 * 1000) {
            taskElement.classList.add('due-soon');
          }
        }
        
        // بناء محتوى المهمة
        let taskContent = `
          <div class="task-content">
            <div class="task-title">${task.title}</div>
            <div class="task-meta">
        `;
        
        if (task.description) {
          taskContent += `<span>${task.description}</span>`;
        }
        
        if (task.deadline) {
          const deadlineDate = new Date(task.deadline);
          taskContent += `<span>الموعد: ${deadlineDate.toLocaleString()}</span>`;
        }
        
        taskContent += `<span class="task-priority priority-${task.priority}">${getPriorityText(task.priority)}</span>`;
        taskContent += `<span>الفئة: ${getCategoryText(task.category)}</span>`;
        
        if (task.file) {
          taskContent += `<span>مرفق: ${task.file}</span>`;
        }
        
        taskContent += `
            </div>
          </div>
          <div class="task-actions">
            <button class="task-btn complete" onclick="completeTask(${task.id})">إكمال</button>
            <button class="task-btn edit" onclick="editTask(${task.id})">تعديل</button>
            <button class="task-btn delete" onclick="deleteTask(${task.id})">حذف</button>
          </div>
        `;
        
        taskElement.innerHTML = taskContent;
        taskList.appendChild(taskElement);
      });
    }

    function getPriorityText(priority) {
      const priorities = {
        high: 'عالية',
        medium: 'متوسطة',
        low: 'منخفضة'
      };
      return priorities[priority] || priority;
    }

    function getCategoryText(category) {
      const categories = {
        work: 'عمل',
        personal: 'شخصي',
        study: 'دراسة',
        health: 'صحة'
      };
      return categories[category] || category;
    }

    // وظائف التبويب
    function switchTab(tabId) {
      // إخفاء جميع المحتويات
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      // إلغاء تنشيط جميع ألسنة التبويب
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // عرض المحتوى المحدد
      document.getElementById(`${tabId}-tab`).classList.add('active');
      
      // تنشيط لسان التبويب المحدد
      const tabs = document.querySelectorAll('.tab');
      for (let i = 0; i < tabs.length; i++) {
        if (tabs[i].textContent.toLowerCase().includes(tabId)) {
          tabs[i].classList.add('active');
          break;
        }
      }
      
      // تحديث الرسوم البيانية عند التبديل إلى لوحة التحكم
      if (tabId === 'dashboard') {
        updateCharts();
      }
    }

    // وظائف الفريق
    function showInviteModal() {
      document.getElementById('inviteModal').style.display = 'flex';
    }

    function hideInviteModal() {
      document.getElementById('inviteModal').style.display = 'none';
    }

    function sendInvite() {
      const email = document.getElementById('inviteEmail').value;
      const role = document.getElementById('inviteRole').value;
      
      if (!email) {
        alert('الرجاء إدخال بريد إلكتروني صحيح');
        return;
      }
      
      // هنا يمكنك إضافة كود لإرسال الدعوة فعليًا
      alert(`تم إرسال دعوة إلى ${email} كـ ${role === 'admin' ? 'مدير' : 'عضو'}`);
      hideInviteModal();
    }

    // وظائف الإعدادات
    function toggleTheme() {
      state.settings.darkMode = !state.settings.darkMode;
      applySettings();
      saveState();
    }

    function changeThemeColor(color) {
      state.settings.themeColor = color;
      document.documentElement.style.setProperty('--main-color', color);
      saveState();
    }

    function applySettings() {
      if (state.settings.darkMode) {
        document.body.classList.add('light-mode');
      } else {
        document.body.classList.remove('light-mode');
      }
      
      document.documentElement.style.setProperty('--main-color', state.settings.themeColor);
      document.getElementById('darkMode').checked = state.settings.darkMode;
      document.getElementById('themeColor').value = state.settings.themeColor;
    }

    // وظائف الحفظ والتحميل
    function saveState() {
      localStorage.setItem('tasks', JSON.stringify(state.tasks));
      localStorage.setItem('user', JSON.stringify(state.user));
      localStorage.setItem('settings', JSON.stringify(state.settings));
    }

    function loadState() {
      const savedTasks = localStorage.getItem('tasks');
      const savedUser = localStorage.getItem('user');
      const savedSettings = localStorage.getItem('settings');
      
      if (savedTasks) state.tasks = JSON.parse(savedTasks);
      if (savedUser) state.user = JSON.parse(savedUser);
      if (savedSettings) state.settings = JSON.parse(savedSettings);
      
      applySettings();
    }

    function saveTasks() {
      localStorage.setItem('tasks', JSON.stringify(state.tasks));
    }

    // وظائف الرسوم البيانية
    function initCharts() {
      // رسم بياني لأداء الأسبوع
      const weeklyCtx = document.getElementById('weeklyChart').getContext('2d');
      new Chart(weeklyCtx, {
        type: 'line',
        data: {
          labels: ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'],
          datasets: [{
            label: 'المهام المكتملة',
            data: [3, 5, 2, 6, 4, 7, 1],
            borderColor: 'rgba(0, 255, 170, 1)',
            backgroundColor: 'rgba(0, 255, 170, 0.1)',
            tension: 0.3,
            fill: true
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
              rtl: true
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
      
      // رسم بياني لتوزيع المهام
      const tasksCtx = document.getElementById('tasksChart').getContext('2d');
      new Chart(tasksCtx, {
        type: 'doughnut',
        data: {
          labels: ['مكتملة', 'قيد الإنجاز', 'متأخرة'],
          datasets: [{
            data: [12, 5, 3],
            backgroundColor: [
              'rgba(0, 255, 170, 0.7)',
              'rgba(0, 170, 255, 0.7)',
              'rgba(255, 85, 85, 0.7)'
            ],
            borderColor: [
              'rgba(0, 255, 170, 1)',
              'rgba(0, 170, 255, 1)',
              'rgba(255, 85, 85, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom',
              rtl: true
            }
          }
        }
      });
      
      // رسم بياني للإحصائيات
      const statsCtx = document.getElementById('statsChart').getContext('2d');
      new Chart(statsCtx, {
        type: 'bar',
        data: {
          labels: ['عمل', 'شخصي', 'دراسة', 'صحة'],
          datasets: [{
            label: 'المهام حسب الفئة',
            data: [8, 5, 6, 2],
            backgroundColor: [
              'rgba(0, 255, 170, 0.7)',
              'rgba(0, 170, 255, 0.7)',
              'rgba(170, 0, 255, 0.7)',
              'rgba(255, 170, 0, 0.7)'
            ],
            borderColor: [
              'rgba(0, 255, 170, 1)',
              'rgba(0, 170, 255, 1)',
              'rgba(170, 0, 255, 1)',
              'rgba(255, 170, 0, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true
            }
          },
          plugins: {
            legend: {
              display: false
            }
          }
        }
      });
      
      // رسم بياني للأداء
      const performanceCtx = document.getElementById('performanceChart').getContext('2d');
      new Chart(performanceCtx, {
        type: 'radar',
        data: {
          labels: ['الإنتاجية', 'السرعة', 'الدقة', 'التعاون', 'الإبداع'],
          datasets: [{
            label: 'أدائك',
            data: [85, 70, 90, 60, 75],
            backgroundColor: 'rgba(0, 255, 170, 0.2)',
            borderColor: 'rgba(0, 255, 170, 1)',
            pointBackgroundColor: 'rgba(0, 255, 170, 1)',
            pointBorderColor: '#fff',
            pointHoverBackgroundColor: '#fff',
            pointHoverBorderColor: 'rgba(0, 255, 170, 1)'
          }]
        },
        options: {
          responsive: true,
          scales: {
            r: {
              angleLines: {
                display: true
              },
              suggestedMin: 0,
              suggestedMax: 100
            }
          }
        }
      });
      
      // رسم بياني للأولويات
      const priorityCtx = document.getElementById('priorityChart').getContext('2d');
      new Chart(priorityCtx, {
        type: 'pie',
        data: {
          labels: ['عالي', 'متوسط', 'منخفض'],
          datasets: [{
            data: [4, 8, 3],
            backgroundColor: [
              'rgba(255, 85, 85, 0.7)',
              'rgba(255, 170, 0, 0.7)',
              'rgba(85, 255, 0, 0.7)'
            ],
            borderColor: [
              'rgba(255, 85, 85, 1)',
              'rgba(255, 170, 0, 1)',
              'rgba(85, 255, 0, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom',
              rtl: true
            }
          }
        }
      });
    }

    function updateCharts() {
      // يمكنك تحديث بيانات الرسوم البيانية هنا عند الحاجة
    }

    // وظائف أخرى
    function checkDeadlines() {
      const now = new Date();
      state.tasks.forEach(task => {
        if (task.deadline && !task.completed) {
          const deadline = new Date(task.deadline);
          if (deadline < now) {
            // المهمة متأخرة
            if (state.settings.notifications) {
              showNotification(`المهمة "${task.title}" متأخرة!`);
            }
          } else if ((deadline - now) < 24 * 60 * 60 * 1000) {
            // المهمة قريبة من الموعد النهائي
            if (state.settings.notifications) {
              showNotification(`الموعد النهائي للمهمة "${task.title}" يقترب!`);
            }
          }
        }
      });
      
      renderTasks();
    }

    function showNotification(message) {
      if (!('Notification' in window)) return;
      
      if (Notification.permission === 'granted') {
        new Notification(message);
      } else if (Notification.permission !== 'denied') {
        Notification.requestPermission().then(permission => {
          if (permission === 'granted') {
            new Notification(message);
          }
        });
      }
    }

    function startVoiceInput() {
      if (!('webkitSpeechRecognition' in window)) {
        alert('المتصفح الخاص بك لا يدعم التعرف على الصوت');
        return;
      }
      
      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'ar-SA';
      recognition.start();
      
      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        document.getElementById('taskTitle').value = transcript;
      };
      
      recognition.onerror = function(event) {
        alert('حدث خطأ في التعرف على الصوت: ' + event.error);
      };
    }

    function exportData() {
      const data = {
        tasks: state.tasks,
        user: state.user,
        exportedAt: new Date().toISOString()
      };
      
      const dataStr = JSON.stringify(data, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const dataUrl = URL.createObjectURL(dataBlob);
      
      const downloadLink = document.createElement('a');
      downloadLink.href = dataUrl;
      downloadLink.download = `taskmaster-data-${new Date().toISOString().split('T')[0]}.json`;
      downloadLink.click();
    }

    // وظائف البحث والتصفية
    function searchTasks(query) {
      const tasks = document.querySelectorAll('.task-item');
      query = query.toLowerCase();
      
      tasks.forEach(task => {
        const title = task.querySelector('.task-title').textContent.toLowerCase();
        const description = task.querySelector('.task-meta')?.textContent.toLowerCase() || '';
        
        if (title.includes(query) || description.includes(query)) {
          task.style.display = 'flex';
        } else {
          task.style.display = 'none';
        }
      });
    }

    document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', function () {
    // إزالة الفئة "active" من جميع التبويبات
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    
    // إضافة الفئة "active" للتبويب الحالي
    this.classList.add('active');
    
    // تحديث الخط المتحرك أسفل التبويب
    const tabsRect = this.parentElement.getBoundingClientRect();
    const tabRect = this.getBoundingClientRect();
    const underline = this.parentElement.querySelector('::after');
    underline.style.left = `${tabRect.left - tabsRect.left}px`;
    underline.style.width = `${tabRect.width}px`;
  });
});

    function filterTasks(filter) {
      const tasks = document.querySelectorAll('.task-item');
      
      tasks.forEach(task => {
        const isCompleted = task.classList.contains('completed');
        const isOverdue = task.classList.contains('overdue');
        
        switch (filter) {
          case 'all':
            task.style.display = 'flex';
            break;
          case 'completed':
            task.style.display = isCompleted ? 'flex' : 'none';
            break;
          case 'pending':
            task.style.display = !isCompleted ? 'flex' : 'none';
            break;
          case 'overdue':
            task.style.display = isOverdue ? 'flex' : 'none';
            break;
          default:
            task.style.display = 'flex';
        }
      });
    }

    function sortTasks(sortBy) {
      let sortedTasks = [...state.tasks];
      
      switch (sortBy) {
        case 'date-desc':
          sortedTasks.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
          break;
        case 'date-asc':
          sortedTasks.sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));
          break;
        case 'priority':
          const priorityOrder = { high: 3, medium: 2, low: 1 };
          sortedTasks.sort((a, b) => priorityOrder[b.priority] - priorityOrder[a.priority]);
          break;
        default:
          // لا تغيير في الترتيب
      }
      
      state.tasks = sortedTasks;
      saveTasks();
      renderTasks();
    }
  </script>
</body>
</html>
